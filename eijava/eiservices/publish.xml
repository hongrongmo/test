<project name="publish-eijava" default="live" basedir=".">
	
	<property file="build.properties"/>
	<property name="live.data.cluster" id="liveDataCluster" value="cv3-1,cv4-1"/>
	
	<property name="live.sessionservice.workdir" id="liveSessionServiceWorkDir" value="/export/home/sespub/working"/>
	<property name="live.sessionservice.username" id="liveSessionServiceUsername" value="sespub"/>
	<property name="live.sessionservice.password" id="liveSessionServicePassword" value="sinatra1"/>
	

	<property name="live.logservice.workdir" id="liveLogServiceWorkDir" value="/export/home/logpub/working"/>
	<property name="live.logservice.username" id="liveLogServiceUsername" value="logpub"/>
	<property name="live.logservice.password" id="liveLogServicePassword" value="3ep1111"/>


	<target name="all">
		<echo message="Moving the war files ......"/>
		<antcall target="live-sessionservice-move"/>
		<antcall target="live-logservice-move"/>
		
		<echo message="Stopping the servers ......"/>
		<antcall target="live-sessionservice-stop"/>
		<antcall target="live-logservice-stop"/>
		
		<echo message="Moving the war files into position ......"/>		
		<antcall target="live-sessionservice-position"/>
		<antcall target="live-logservice-position"/>
		

		<echo message="Makeing sure the servers have had time to shutdown ....."/>
		<sleep milliseconds="4000"/>
		<echo message="Starting the servers ......." />
		<antcall target="live-sessionservice-start"/>
		<antcall target="live-logservice-start"/>
	</target>

	<target name="sessionservice">
		<antcall target="live-sessionservice-move"/>
		<antcall target="live-sessionservice-stop"/>
		<antcall target="live-sessionservice-position"/>
		<sleep milliseconds="4000"/>
		<antcall target="live-sessionservice-start"/>
	</target>

	<target name="logservice">
		<antcall target="live-logservice-move"/>
		<antcall target="live-logservice-stop"/>
		<antcall target="live-logservice-position"/>
		<sleep milliseconds="4000"/>
		<antcall target="live-logservice-start"/>
	</target>


	<target name="live-sessionservice-move">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				ftpliveSessionService.setServer(clusterArray[i]);
				ftpliveSessionService.setUserid(liveSessionServiceUsername.getValue());
				ftpliveSessionService.setPassword(liveSessionServicePassword.getValue());
				ftpliveSessionService.setRemotedir(liveSessionServiceWorkDir.getValue());
				liveSessionServicePut.execute();
			}

			]]>
		</script>		
	</target>


	<target name="live-logservice-move">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				ftpliveLogService.setServer(clusterArray[i]);
				ftpliveLogService.setUserid(liveLogServiceUsername.getValue());
				ftpliveLogService.setPassword(liveLogServicePassword.getValue());
				ftpliveLogService.setRemotedir(liveLogServiceWorkDir.getValue());
				liveLogServicePut.execute();
			}

			]]>
		</script>		
	</target>



	<target name="live-sessionservice-stop">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStopSessionService.setServer(clusterArray[i]);
				telnetStopSessionService.setUserid(liveSessionServiceUsername.getValue());
				telnetStopSessionService.setPassword(liveSessionServicePassword.getValue());
				liveSessionServiceStop.execute();
			}
			]]>
		</script>		
	</target>

	<target name="live-logservice-stop">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStopLogService.setServer(clusterArray[i]);
				telnetStopLogService.setUserid(liveLogServiceUsername.getValue());
				telnetStopLogService.setPassword(liveLogServicePassword.getValue());
				liveLogServiceStop.execute();
			}
			]]>
		</script>		
	</target>


	<target name="live-sessionservice-position">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetPositionSessionService.setServer(clusterArray[i]);
				telnetPositionSessionService.setUserid(liveSessionServiceUsername.getValue());
				telnetPositionSessionService.setPassword(liveSessionServicePassword.getValue());
				liveSessionServicePosition.execute();
			}
			]]>

		</script>		
	</target>

	<target name="live-logservice-position">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetPositionLogService.setServer(clusterArray[i]);
				telnetPositionLogService.setUserid(liveLogServiceUsername.getValue());
				telnetPositionLogService.setPassword(liveLogServicePassword.getValue());
				liveLogServicePosition.execute();
			}
			]]>

		</script>		
	</target>




	<target name="live-sessionservice-start">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStartSessionService.setServer(clusterArray[i]);
				telnetStartSessionService.setUserid(liveSessionServiceUsername.getValue());
				telnetStartSessionService.setPassword(liveSessionServicePassword.getValue());
				liveSessionServiceStart.execute();
			}
			]]>

		</script>		
	</target>

	<target name="live-logservice-start">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStartLogService.setServer(clusterArray[i]);
				telnetStartLogService.setUserid(liveLogServiceUsername.getValue());
				telnetStartLogService.setPassword(liveLogServicePassword.getValue());
				liveLogServiceStart.execute();
			}
			]]>

		</script>		
	</target>




	<target name="liveSessionServicePut">
		<ftp 	id="ftpliveSessionService"
			binary="yes">
			<fileset dir="sessionservice/live">
				<include name="sessionservice.war"/>
			</fileset>
		</ftp>	
        </target>

	<target name="liveLogServicePut">
		<ftp 	id="ftpliveLogService"
			binary="yes">
			<fileset dir="logservice/live">
				<include name="logservice.war"/>
			</fileset>
		</ftp>	
        </target>

	<target name="liveSessionServiceStart">
		<telnet id="telnetStartSessionService">
        		<write>source sessionservice.env; echo Done</write>
			<read>Done</read>
        		<write>cd sessionservice_appserver/bin; echo Done</write>
			<write>./startup.sh</write>
			<read timeout="10">Done</read>
			<write/>
			<write>sleep 15; echo Done</write>
			<read>Done</read>
			<write>cat ../logs/catalina.out; echo Done</write>
			<read>Done</read>
			<write/>
     		</telnet>
	</target>

	<target name="liveLogServiceStart">
		<telnet id="telnetStartLogService">
        		<write>source log.env; echo Done</write>
			<read>Done</read>
        		<write>cd log_appserver/bin; echo Done</write>
			<write>./startup.sh</write>
			<read timeout="15">Starting Ajp12ConnectionHandler on 8091</read>
			<write/>
     		</telnet>
	</target>




	<target name="liveSessionServiceStop">
		<telnet id="telnetStopSessionService">
        		<write>source sessionservice.env; echo Done</write>
        		<read>Done</read>
			<write>cd sessionservice_appserver/bin; echo Done</write>
			<read>Done</read>
			<write>./shutdown.sh; echo Done</write>
			<read>Done</read>
     		</telnet>
	</target>

	<target name="liveLogServiceStop">
		<telnet id="telnetStopLogService">
        		<write>source log.env; echo Done</write>
        		<read>Done</read>
			<write>cd log_appserver/bin; echo Done</write>
			<read>Done</read>
			<write>./shutdown.sh; echo Done</write>
			<read>Done</read>
     		</telnet>
	</target>


	<target name="liveSessionServicePosition">
		<telnet id="telnetPositionSessionService">
        		<write><![CDATA[rm -rf sessionservice_appserver/webapps/sessionservice* 2> /dev/null; echo Done]]></write>
			<read>Done</read>
			<write><![CDATA[mv working/sessionservice.war sessionservice_appserver/webapps 2> /dev/null; echo Done]]></write>
			<read>Done</read>
     		</telnet>
	</target>

	<target name="liveLogServicePosition">
		<telnet id="telnetPositionLogService">
        		<write><![CDATA[rm -rf log_appserver/webapps/logservice* 2> /dev/null; echo Done]]></write>
			<read>Done</read>
			<write><![CDATA[mv working/logservice.war log_appserver/webapps 2> /dev/null; echo Done]]></write>
			<read>Done</read>
     		</telnet>
	</target>


</project>
