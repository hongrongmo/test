<project name="Webapp Precompilation" default="all" basedir=".">


<!-- Override Values
  ..\eijava\engvillage\engvillage>ant -f precompile.xml -Dwebapp.path=c:\baja\appserver.4\webapps\engvillage -Dtomcat.home=c:\baja\appserver.4 -->
  <property environment="env"/>

	<property name="webapp.path" value="${env.CATALINA_HOME}\webapps\engvillage"/>
	<property name="tomcat.home" value="${env.CATALINA_HOME}"/>


  <target name="deploy">
    <!-- delete and refresh jsps -->
    <delete dir="${webapp.path}/models"/>
    <ant dir="." target="copyfiles">
      <property name="deploy.home" value="${webapp.path}"/>
    </ant>
  </target>

  <target name="jspc">

    <!-- refresh any jsps that have changed in the source tree -->
    <ant dir="." target="copyfiles">
      <property name="deploy.home" value="${webapp.path}"/>
    </ant>

    <taskdef classname="org.apache.jasper.JspC" name="jasper2" >
      <classpath id="jspc.classpath">
        <pathelement location="${java.home}/../lib/tools.jar"/>
        <fileset dir="${tomcat.home}/server/lib">
          <include name="*.jar"/>
        </fileset>
        <fileset dir="${tomcat.home}/common/lib">
          <include name="*.jar"/>
        </fileset>
      </classpath>
    </taskdef>

    <jasper2
       validateXml="false"
       uriroot="${webapp.path}"
       webXmlFragment="${webapp.path}/WEB-INF/generated_web.xml"
       outputDir="${webapp.path}/WEB-INF/src" />

  </target>

  <target name="clean">
    <delete dir="${webapp.path}/WEB-INF/src"/>
    <delete dir="${webapp.path}/WEB-INF/classes"/>
    <delete file="${webapp.path}/WEB-INF/generated_web.xml"/>
  </target>

  <target name="compile">

    <mkdir dir="${webapp.path}/WEB-INF/classes"/>
    <mkdir dir="${webapp.path}/WEB-INF/lib"/>

    <javac destdir="${webapp.path}/WEB-INF/classes"
           optimize="off"
           debug="on" failonerror="false"
           srcdir="${webapp.path}/WEB-INF/src"
	   excludes="**/*.smap">
      <classpath>
        <pathelement location="${webapp.path}/WEB-INF/classes"/>
        <fileset dir="${webapp.path}/WEB-INF/lib">
          <include name="*.jar"/>
        </fileset>
        <pathelement location="${tomcat.home}/common/classes"/>
        <fileset dir="${tomcat.home}/common/lib">
          <include name="*.jar"/>
        </fileset>
        <pathelement location="${tomcat.home}/shared/classes"/>
        <fileset dir="${tomcat.home}/shared/lib">
          <include name="*.jar"/>
        </fileset>
      </classpath>
      <include name="**" />
      <!-- included files -->
      <exclude name="**/customer/queryForm_jsp.java" />
      <exclude name="**/customer/database_jsp.java" />
      <!-- dead files -->
      <exclude name="**/customer/edittags_jsp.java" />
      <exclude name="**/customer/EndSession_jsp.java" />
      <exclude name="**/customer/fullTextLink_jsp.java" />
      <exclude name="**/customer/getEntryDedupForward_jsp.java" />
      <exclude name="**/customer/printSelectedFormatResults_jsp.java" />
      <exclude name="**/customer/termsuggester_jsp.java" />
      <exclude name="**/customer/tagGroupAddMember_jsp.java" />
      <exclude name="**/customer/books/bookTicketer_jsp.java" />
      <exclude name="**/world/termsearch_jsp.java" />
      <exclude name="**/world/termsuggester_jsp.java" />
      <exclude name="**/world/EndSession_jsp.java" />
    </javac>

  </target>

  <target name="all" depends="deploy,clean,jspc,compile">
  </target>

</project>

