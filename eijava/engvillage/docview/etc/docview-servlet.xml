<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
    <!-- Document Rendering Pipeline stages -->

    <bean id="httpFileRetriever" class="no.fast.foundation.docview.httpcontentfetcher.HttpContentFetcher">
        <property name="rootUrl" value="http://usage.elsevier.com:9500/" />
    </bean>

    <bean id="fileSystemRetriever" class="no.fast.foundation.docview.filesystemfetcher.FileSystemFetcher">
        <property name="rootPaths">
            <list>
                <value>@referex_path@</value>
            </list>
        </property>
        <property name="fileExtensionContentType">
            <props>
                <prop key="htm">text/html</prop>
                <prop key="html">text/html</prop>
                <prop key="offsetinfo">text/plain</prop>
                <prop key="pdf">application/pdf</prop>
            </props>
        </property>
    </bean>


<!-- Not required by Elsevier
    <bean id="xmlTransformer" class="no.fast.foundation.docview.xmltransformer.XmlTransformer">
        <property name="securityFactory" ref="securityFactory" />
        <property name="styleSheetResolver" ref="styleSheetResolver" />
        <property name="defaultStyleSheet" value="http://localhost:8080/docren/scion_docview.xsl" />
    </bean>

    <bean id="htmlHighlighter" class="no.fast.foundation.docview.htmlhithighlighter.HtmlHitHighlighter">
        <property name="preHitTag" value="&lt;span id=&quot;hitstyle${hit_num}&quot; style=&quot;background-color:#F0E68C&quot;&gt;" />
        <property name="postHitTag" value="&lt;/span&gt;" />
        <property name="wordSegmenters">
            <map>
                <entry key="default" value-ref="latin" />
            </map>
        </property>
    </bean>
-->

    <bean id="pdfHitHighlighter" class="no.fast.foundation.docview.pdfhithighlighter.PDFHitHighlighter">
    </bean>



    <!-- Document Rendering Pipeline -->
    <bean id="defaultPipeline" class="no.fast.foundation.docview.Pipeline">
        <property name="name" value="default" />
        <property name="stages">
            <list>
                <ref bean="fileSystemRetriever"/>
<!-- Not required by Elsevier
                <ref bean="htmlHighlighter"/>
-->
                <ref bean="pdfHitHighlighter"/>
            </list>
        </property>
    </bean>

<!-- Not required by Elsevier
    <bean id="xmlPipeline" class="no.fast.foundation.docview.Pipeline">
        <property name="name" value="xml" />
        <property name="stages">
            <list>
                <ref bean="fileSystemRetriever"/>
                <ref bean="xmlTransformer"/>
                <ref bean="htmlHighlighter"/>
            </list>
        </property>
    </bean>
    <bean id="httpPipeline" class="no.fast.foundation.docview.Pipeline">
        <property name="name" value="http" />
        <property name="stages">
            <list>
                <ref bean="httpFileRetriever"/>
                <ref bean="htmlHighlighter"/>
            </list>
        </property>
    </bean>
    <bean id="xsltPipeline" class="no.fast.foundation.docview.Pipeline">
        <property name="name" value="xsltPipeline" />
        <property name="stages">
            <list>
                <ref bean="fileSystemRetriever"/>
            </list>
        </property>
    </bean>
-->

    <!-- Supporting classes -->
    <bean id="docView" class="no.fast.foundation.docview.DocView">
        <property name="pipelines">
            <list>
                <ref bean="defaultPipeline"/>

<!-- Not required by Elsevier
                <ref bean="xmlPipeline"/>
                <ref bean="httpPipeline"/>
-->

            </list>
        </property>
    </bean>

    <bean id="docSecurityCheck" class="no.fast.foundation.docaccess.NoSecurityCheck" />

    <bean id="docRetrieval" class="no.fast.foundation.docaccess.DocumentFactory">
        <property name="docView" ref="docView" />
        <property name="securityCheck" ref="docSecurityCheck" />
    </bean>

    <bean id="latin" class="no.fast.foundation.docview.wordsegmenter.LatinWordSegmenter" />


    <!-- XML Document Rendering -->
<!-- Not required by Elsevier
    <bean id="xsltDocView" class="no.fast.foundation.docview.DocView">
        <property name="pipelines">
            <list>
                <ref bean="xsltPipeline"/>
            </list>
        </property>
    </bean>

    <bean id="styleSheetResolver" class="no.fast.foundation.docview.xmltransformer.docviewstylesheetresolver.DocViewStyleSheetResolver">
        <property name="docView" ref="xsltDocView" />
        <property name="styleSheetPipeline" value="xsltPipeline" />
    </bean>
-->

    <bean id="securityFactory" class="no.fast.foundation.security.jaas.JAASSecurityFactory">
        <property name="anonymousUserID" value="anonymous" />
        <property name="anonymousUsername" value="anonymous" />
        <property name="anonymousUserPassword" value="" />
        <property name="loginModules">
            <list>
                <ref bean="xmlAuthSecurityProvider" />
            </list>
        </property>
        <property name="permissionDecorators">
            <list>
                <ref bean="xmlSecurityProvider" />
            </list>
        </property>
        <property name="principalDecorators">
            <list>
                <ref bean="xmlSecurityProvider" />
            </list>
        </property>
    </bean>
    <bean id="xmlAuthSecurityProvider" class="no.fast.foundation.security.provider.jaas.JAASGenericLoginFactory">
        <property name="sufficient" value="1" />
        <property name="securityHelper" ref="xmlSecurityProvider" />
    </bean>
    <bean id="xmlSecurityProvider" class="no.fast.foundation.security.provider.XMLSecurityProvider" />
    <bean id="maxSessions" class="java.lang.Integer">
        <constructor-arg value="500" />
    </bean>


    <!-- Spring Framework MVC controllers and view resolvers -->
    <bean id="documentAccessMapper" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="mappings">
            <props>
                <prop key="/**">documentController</prop>
            </props>
        </property>
    </bean>
    <bean id="documentController" class="no.fast.foundation.extras.webapphelper.document.DocumentController" />
    <bean id="documentViewResolver" class="no.fast.foundation.extras.webapphelper.document.DocumentViewResolver">
        <property name="order"><value>1</value></property>
        <property name="transferAllRequestParameters" value="1" />
        <property name="docAccess"><ref bean="docRetrieval" /></property>
        <property name="accessDeniedRedirectPath"><value>${request.contextpath}/error.htm?view=error&amp;error=denied&amp;contentURL=${path}</value></property>
        <property name="noSuchDocumentRedirectPath"><value>${request.contextpath}/error.htm?view=error&amp;error=missing&amp;contentURL=${path}</value></property>
        <property name="serverErrorRedirectPath"><value>${request.contextpath}/error.htm?view=error&amp;error=missing&amp;contentURL=${path}</value></property>
    </bean>
</beans>
