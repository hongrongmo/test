<project name="publish-chemvillage" default="stage" basedir=".">
	
	<property file="build.properties"/>
	<property name="live.data.cluster" id="liveDataCluster" value="cv3-1,cv4-1"/>
	<property name="live.controller.cluster" id="liveControllerCluster" value="cv3-1,cv4-1"/>
	<property name="live.workdir" id="liveWorkDir" value="/export/home/engpub/working"/>
	<property name="live.username" id="liveUsername" value="engpub"/>
	<property name="live.password" id="livePassword" value="2ep1111"/>

	<target name="all">
		<echo message="Moving the war files ......"/>
		<antcall target="live-controller-move"/>
		<antcall target="live-engresources-move"/>
		<antcall target="live-engvillage-move"/>
		
		
		<echo message="Stopping the servers ......"/>
		<antcall target="live-controller-stop"/>
		<antcall target="live-engvillage-stop"/>


		<echo message="Moving the war files into position ......"/>
		<antcall target="live-controller-position"/>
		<antcall target="live-engvillage-position"/>
		<antcall target="live-engresources-position"/>

		<echo message="Makeing sure the servers have had time to shutdown ....."/>
		<sleep milliseconds="4000"/>

		<echo message="Starting the servers ......." />
		<antcall target="live-engvillage-start"/>
		<antcall target="live-controller-start"/>
	</target>

	<target name="controller">
		<antcall target="live-controller-move"/>
		<antcall target="live-controller-stop"/>
		<antcall target="live-controller-position"/>
		<sleep milliseconds="4000"/>
		<antcall target="live-controller-start"/>
	</target>


	<target name="engresources">
		<antcall target="live-engresources-move"/>
		<antcall target="live-engresources-position"/>		
	</target>

	<target name="engvillage">
		<antcall target="live-engvillage-move"/>
		<antcall target="live-engvillage-stop"/>
		<antcall target="live-engvillage-position"/>
		<sleep milliseconds="4000"/>
		<antcall target="live-engvillage-start"/>
	</target>
	
	<target name="live-controller-start">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStartController.setServer(clusterArray[i]);
				telnetStartController.setUserid(liveUsername.getValue());
				telnetStartController.setPassword(livePassword.getValue());
				liveControllerStart.execute();
			}
			]]>

		</script>		
	</target>


	<target name="live-controller-stop">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStopController.setServer(clusterArray[i]);
				telnetStopController.setUserid(liveUsername.getValue());
				telnetStopController.setPassword(livePassword.getValue());
				liveControllerStop.execute();
			}
			]]>
		</script>		
	</target>

	<target name="live-controller-position">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetPositionController.setServer(clusterArray[i]);
				telnetPositionController.setUserid(liveUsername.getValue());
				telnetPositionController.setPassword(livePassword.getValue());
				liveControllerPosition.execute();
			}
			]]>

		</script>		
	</target>


	<target name="live-ohubservice-position">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetPositionOHUBService.setServer(clusterArray[i]);
				telnetPositionOHUBService.setUserid(liveUsername.getValue());
				telnetPositionOHUBService.setPassword(livePassword.getValue());
				liveOHUBServicePosition.execute();
			}
			]]>

		</script>		
	</target>
	
	<target name="live-controller-move">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				ftpliveController.setServer(clusterArray[i]);
				ftpliveController.setUserid(liveUsername.getValue());
				ftpliveController.setPassword(livePassword.getValue());
				ftpliveController.setRemotedir(liveWorkDir.getValue());
				liveControllerPut.execute();
			}

			]]>
		</script>		
	</target>

	

	<target name="live-engresources-move">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				ftpliveEngResources.setServer(clusterArray[i]);
				ftpliveEngResources.setUserid(liveUsername.getValue());
				ftpliveEngResources.setPassword(livePassword.getValue());
				ftpliveEngResources.setRemotedir(liveWorkDir.getValue());
				liveEngResourcesPut.execute();
			}
			]]>

		</script>	
	</target>


	<target name="live-ohubservice-move">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				ftpliveOHUBService.setServer(clusterArray[i]);
				ftpliveOHUBService.setUserid(liveUsername.getValue());
				ftpliveOHUBService.setPassword(livePassword.getValue());
				ftpliveOHUBService.setRemotedir(liveWorkDir.getValue());
				liveOHUBServicePut.execute();
			}
			]]>

		</script>	
	</target>

	<target name="live-engresources-position">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveControllerCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetPositionEngResources.setServer(clusterArray[i]);
				telnetPositionEngResources.setUserid(liveUsername.getValue());
				telnetPositionEngResources.setPassword(livePassword.getValue());
				liveEngResourcesPosition.execute();
			}
			]]>

		</script>		
	</target>	

	<target name="live-engvillage-move">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				ftpliveEngVillage.setServer(clusterArray[i]);
				ftpliveEngVillage.setUserid(liveUsername.getValue());
				ftpliveEngVillage.setPassword(livePassword.getValue());
				ftpliveEngVillage.setRemotedir(liveWorkDir.getValue());
				liveEngVillagePut.execute();
			}

			]]>
		</script>		
	</target>  


	<target name="live-engvillage-start">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStartEngVillage.setServer(clusterArray[i]);
				telnetStartEngVillage.setUserid(liveUsername.getValue());
				telnetStartEngVillage.setPassword(livePassword.getValue());
				liveEngVillageStart.execute();
			}
			]]>

		</script>		
	</target>

	<target name="live-engvillage-stop">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetStopEngVillage.setServer(clusterArray[i]);
				telnetStopEngVillage.setUserid(liveUsername.getValue());
				telnetStopEngVillage.setPassword(livePassword.getValue());
				liveEngVillageStop.execute();
			}
			]]>
		</script>		
	</target>

	<target name="live-engvillage-position">
		<script language="javascript">
			<![CDATA[
			var theStrings = liveDataCluster.getValue();
			var clusterString = String(theStrings);
			var clusterArray  =  clusterString.split(",");
			for (var i=0; i < clusterArray.length; i++)
			{
				telnetPositionEngVillage.setServer(clusterArray[i]);
				telnetPositionEngVillage.setUserid(liveUsername.getValue());
				telnetPositionEngVillage.setPassword(livePassword.getValue());
				liveEngVillagePosition.execute();
			}
			]]>
		</script>		
	</target>




	<target name="liveControllerPut">
		<ftp 	id="ftpliveController"
			binary="yes">
			<fileset dir="controller/live">
				<include name="controller.war"/>
			</fileset>
		</ftp>	
        </target>

	<target name="liveEngResourcesPut">
		<ftp 	id="ftpliveEngResources"
			binary="yes">
			<fileset dir="engresources/live">
				<include name="engresources.war"/>
			</fileset>
		</ftp>	
        </target>


	<target name="liveEngVillagePut">
		<ftp 	id="ftpliveEngVillage"
			binary="yes">
			<fileset dir="engvillage/live">
				<include name="engvillage.war"/>
			</fileset>
		</ftp>	
        </target>


	<target name="liveOHUBServicePut">
		<ftp 	id="ftpliveOHUBService"
			binary="yes">
			<fileset dir="ohubservice/live">
				<include name="ohubservice.war"/>
			</fileset>
		</ftp>	
        </target>

	<target name="liveControllerStop">
		<telnet id="telnetStopController">
        		<write>source controller2.env; echo Done</write>
        		<read>Done</read>
			<write>cd controller_appserver2/bin; echo Done</write>
			<read>Done</read>
			<write>./shutdown.sh; echo Done</write>
			<read>Done</read>
     		</telnet>
	</target>



	<target name="liveControllerStart">
		<telnet id="telnetStartController">
			<write>source controller2.env; echo Done</write>
			<read>Done</read>
			<write>cd controller_appserver2/bin; echo Done</write>
			<read>Done</read>
			<write>rm ../logs/catalina.out; echo Done</write>
			<read>Done</read>
			<write>./startup.sh</write>
			<read timeout="10">Done</read>
			<write/>
			<write>sleep 15; echo Done</write>
			<read>Done</read>
			<write>cat ../logs/catalina.out; echo Done</write>
			<read>Done</read>
		</telnet>
	</target>



	<target name="liveControllerPosition">
		<telnet id="telnetPositionController">
        		<write><![CDATA[rm -rf controller_appserver2/webapps/controller* 2> /dev/null; echo Done]]></write>
			<read>Done</read>
			<write><![CDATA[mv working/controller.war controller_appserver2/webapps 2> /dev/null; echo Done]]></write>
			<read>Done</read>
     		</telnet>
	</target>

	<target name="liveOHUBServicePosition">
		<telnet id="telnetPositionOHUBService">
        		<write><![CDATA[rm -rf controller_appserver2/webapps/ohubservice* 2> /dev/null; echo Done]]></write>
			<read>Done</read>
			<write><![CDATA[mv working/ohubservice.war controller_appserver2/webapps 2> /dev/null; echo Done]]></write>
			<read>Done</read>
     		</telnet>
	</target>


	<target name="liveEngVillagePosition">
		<telnet id="telnetPositionEngVillage">
        		<write><![CDATA[rm -rf data_appserver2/webapps/engvillage* 2> /dev/null; echo Done]]></write>
			<read>Done</read>
			<write><![CDATA[mv working/engvillage.war data_appserver2/webapps 2> /dev/null; echo Done]]></write>
			<read>Done</read>
     		</telnet>
	</target>

	<target name="liveEngResourcesPosition">
		<telnet id="telnetPositionEngResources">        		
			<write><![CDATA[mkdir working/engresources 2>> /dev/null; echo Done]]></write>
			<read>Done</read>
			<write>mv working/engresources.war working/engresources; echo Done</write>
			<read>Done</read>
			<write>cd working/engresources; echo Done</write>
			<read>Done</read>
			<write>jar -xf engresources.war; echo Done</write>
			<read>Done</read>
			<write>rm engresources.war; echo Done</write>
			<read>Done</read>
			<write>cd ..; echo Done</write>
			<read>Done</read>
			<write>cp -r engresources ../controller_appserver2/webapps; echo Done</write>
			<read>Done</read>
			<write>rm -rf engresources; echo Done</write>
			<read>Done</read>
			<write>rm -rf ../controller_appserver2/webapps/engresources/META-INF; echo Done</write>
			<read>Done</read>
			<write>rm  ../controller_appserver2/webapps/engresources/engresources.war; echo Done</write>
     			<read>Done</read>
		</telnet>
	</target>


	
	<target name="liveEngVillageStart">
		<telnet id="telnetStartEngVillage">
			<write>source data2.env; echo Done</write>
			<read>Done</read>
			<write>cd data_appserver2/bin; echo Done</write>
			<read>Done</read>
			<write>rm ../logs/catalina.out; echo Done</write>
			<read>Done</read>
			<write>./startup.sh</write>
			<read timeout="10">Done</read>
			<write/>
			<write>sleep 30; echo Done</write>
			<read>Done</read>
			<write>cat ../logs/catalina.out; echo Done</write>
			<read>Done</read>
		</telnet>
	</target>

	
	

	<target name="liveEngVillageStop">
		<telnet id="telnetStopEngVillage">
        		<write>source data2.env; echo Done</write>
        		<read>Done</read>
			<write>cd data_appserver2/bin; echo Done</write>
			<read>Done</read>
			<write>./shutdown.sh; echo Done</write>
			<read>Done</read>
     		</telnet>
	</target>
</project>
