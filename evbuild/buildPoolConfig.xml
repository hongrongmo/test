<?xml version="1.0" encoding="UTF-8"?>
<project name="pool-config" default="go">
    <property file="properties/${property_include}.properties" />

	<target name="go"
		depends="clean, doLogPool, doServicePool,doEngvillagePool,doControllerPool"></target>

	<target name="clean">
		<echo>Clean step, using property file ${property_include}.properties (starting in ${basedir}, CWD is ${env.CWD})
		</echo>
		<!-- pools -->
		<delete file="../logservice/WebContent/META-INF/context.xml" />
		<delete file="../sessionservice/WebContent/META-INF/context.xml" />
		<delete file="../engvillage/WebContent/META-INF/context.xml" />
		<delete file="../ROOT/WebContent/META-INF/context.xml" />
	</target>

	<target name="showLogProperties">
		<echo>
			----------------------
			-- log service pool --
			----------------------
			VillageLogPoolURL=${VillageLogPoolURL}
			VillageLogPoolUserName=${VillageLogPoolUserName}
			VillageLogPoolPassword=${VillageLogPoolPassword}
			VillageLogPoolJdbcDriver=${VillageLogPoolJdbcDriver}
			VillageLogPoolMinConnections=${VillageLogPoolMinConnections}
			VillageLogPoolMaxConnections=${VillageLogPoolMaxConnections}
		</echo>
	</target>

	<target name="showServiceAuthProperties">
		<echo>
			-----------------------
			-- service auth pool --
			-----------------------
			AuthPoolURL=${AuthPoolURL}
			AuthPoolUserName=${AuthPoolUserName}
			AuthPoolPassword=${AuthPoolPassword}
			AuthPoolJdbcDriver=${AuthPoolJdbcDriver}
			AuthPoolMinConnections=${AuthPoolMinConnections}
			AuthPoolMaxConnections=${AuthPoolMaxConnections}
		</echo>
	</target>

	<target name="showServiceSessionProperties">
		<echo>
			--------------------------
			-- service session pool --
			--------------------------
			SessionPoolURL=${SessionPoolURL}
			SessionPoolUserName=${SessionPoolUserName}
			SessionPoolPassword=${SessionPoolPassword}
			SessionPoolJdbcDriver=${SessionPoolJdbcDriver}
			SessionPoolMinConnections=${SessionPoolMinConnections}
			SessionPoolMaxConnections=${SessionPoolMaxConnections}
		</echo>
	</target>

	<target name="showEngvillageSearchProperties">
		<echo>
			----------------------------
			-- engvillage search pool --
			----------------------------
			SearchPoolURL=${SearchPoolURL}
			SearchPoolUSearchPoollageSearchUserName}
			SearchPoolPassword=${SearchPoolPassword}
			SearchPoolJdbcDriver=${SearchPoolJdbcDriver}
			SearchPoolMinConnections=${SearchPoolMinConnections}
			SearchPoolMaxConnections=${SearchPoolMaxConnections}
		</echo>
	</target>

	<target name="showEngvillageSessionProperties">
		<echo>
			-----------------------------
			-- engvillage session pool --
			-----------------------------
			SessionPoolURL=${SessionPoolURL}
			SessionPoolUserName=${SessionPoolUserName}
			SessionPoolPassword=${SessionPoolPassword}
			SessionPoolJdbcDriver=${SessionPoolJdbcDriver}
			SessionPoolMinConnections=${SessionPoolMinConnections}
			SessionPoolMaxConnections=${SessionPoolMaxConnections}
		</echo>
	</target>

	<target name="showControllerSearchProperties">
		<echo>
			----------------------------
			-- controller search pool --
			----------------------------
			SearchPoolURL=${SearchPoolURL}
			SearchPoolUserName=${SearchPoolUserName}
			SearchPoolPassword=${SearchPoolPassword}
			SearchPoolJdbcDriver=${SearchPoolJdbcDriver}
			SearchPoolMinConnections=${SearchPoolMinConnections}
			SearchPoolMaxConnections=${SearchPoolMaxConnections}
		</echo>
	</target>

	<target name="showControllerSessionProperties">
		<echo>
			-----------------------------
			-- controller session pool --
			-----------------------------
			SessionPoolURL=${SessionPoolURL}
			SessionPoolUserName=${SessionPoolUserName}
			SessionPoolPassword=${SessionPoolPassword}
			SessionPoolJdbcDriver=${SessionPoolJdbcDriver}
			SessionPoolMinConnections=${SessionPoolMinConnections}
			SessionPoolMaxConnections=${SessionPoolMaxConnections}
		</echo>
	</target>

	<target name="doLogPool" depends="showLogProperties">
		<filter token="log-jdbc.url" value="${VillageLogPoolURL}" />
		<filter token="log-jdbc.username" value="${VillageLogPoolUserName}" />
		<filter token="log-jdbc.password" value="${VillageLogPoolPassword}" />
		<filter token="log-jdbc.driver" value="${VillageLogPoolJdbcDriver}" />
		<filter token="log-jdbc.minconnections" value="${VillageLogPoolMinConnections}" />
		<filter token="log-jdbc.maxconnections" value="${VillageLogPoolMaxConnections}" />

		<copy file="pools/context-logservice.xml" tofile="../logservice/WebContent/META-INF/context.xml"
			filtering="true" />
	</target>

	<target name="doServicePool"
		depends="showServiceAuthProperties,showServiceSessionProperties">
		<filter token="auth-jdbc.url" value="${AuthPoolURL}" />
		<filter token="auth-jdbc.username" value="${AuthPoolUserName}" />
		<filter token="auth-jdbc.password" value="${AuthPoolPassword}" />
		<filter token="auth-jdbc.driver" value="${AuthPoolJdbcDriver}" />
		<filter token="auth-jdbc.minconnections" value="${AuthPoolMinConnections}" />
		<filter token="auth-jdbc.maxconnections" value="${AuthPoolMaxConnections}" />

		<filter token="session-jdbc.url" value="${SessionPoolURL}" />
		<filter token="session-jdbc.username" value="${SessionPoolUserName}" />
		<filter token="session-jdbc.password" value="${SessionPoolPassword}" />
		<filter token="session-jdbc.driver" value="${SessionPoolJdbcDriver}" />
		<filter token="session-jdbc.minconnections" value="${SessionPoolMinConnections}" />
		<filter token="session-jdbc.maxconnections" value="${SessionPoolMaxConnections}" />

		<copy file="pools/context-sessionservice.xml" tofile="../sessionservice/WebContent/META-INF/context.xml"
			filtering="true" />
	</target>

	<target name="doEngvillagePool"
		depends="showEngvillageSearchProperties, showEngvillageSessionProperties">
		<filter token="search-jdbc.url" value="${SearchPoolURL}" />
		<filter token="search-jdbc.username" value="${SearchPoolUserName}" />
		<filter token="search-jdbc.password" value="${SearchPoolPassword}" />
		<filter token="search-jdbc.driver" value="${SearchPoolJdbcDriver}" />
		<filter token="search-jdbc.minconnections" value="${SearchPoolMinConnections}" />
		<filter token="search-jdbc.maxconnections" value="${SearchPoolMaxConnections}" />

		<filter token="session-jdbc.url" value="${SessionPoolURL}" />
		<filter token="session-jdbc.username" value="${SessionPoolUserName}" />
		<filter token="session-jdbc.password" value="${SessionPoolPassword}" />
		<filter token="session-jdbc.driver" value="${SessionPoolJdbcDriver}" />
		<filter token="session-jdbc.minconnections" value="${SessionPoolMinConnections}" />
		<filter token="session-jdbc.maxconnections" value="${SessionPoolMaxConnections}" />

		<copy file="pools/context-engvillage.xml" tofile="../engvillage/WebContent/META-INF/context.xml"
			filtering="true" />
	</target>

	<target name="doControllerPool"
		depends="showControllerSearchProperties, showControllerSessionProperties">
		<filter token="search-jdbc.url" value="${SearchPoolURL}" />
		<filter token="search-jdbc.username" value="${SearchPoolUserName}" />
		<filter token="search-jdbc.password" value="${SearchPoolPassword}" />
		<filter token="search-jdbc.driver" value="${SearchPoolJdbcDriver}" />
		<filter token="search-jdbc.minconnections" value="${SearchPoolMinConnections}" />
		<filter token="search-jdbc.maxconnections" value="${SearchPoolMaxConnections}" />

		<filter token="session-jdbc.url" value="${SessionPoolURL}" />
		<filter token="session-jdbc.username" value="${SessionPoolUserName}" />
		<filter token="session-jdbc.password" value="${SessionPoolPassword}" />
		<filter token="session-jdbc.driver" value="${SessionPoolJdbcDriver}" />
		<filter token="session-jdbc.minconnections" value="${SessionPoolMinConnections}" />
		<filter token="session-jdbc.maxconnections" value="${SessionPoolMaxConnections}" />

		<copy file="pools/context-controller.xml" tofile="../ROOT/WebContent/META-INF/context.xml"
			filtering="true" />
	</target>

</project>