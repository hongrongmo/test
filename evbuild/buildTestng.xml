<project default="test">
	
    <property environment="env"/>
    <!-- Default the property include to "local" -->
    <property name="property_include" value="local"/>
    <property file="properties/${property_include}.properties"/>
	<property name="testng.report.dir" value="../ROOT/test/testngreport"/>
	<property name="test.build.dir" value="../ROOT/test"/>
	<property name="workdir" value="../ROOT"/>
	<property name="compile.debug" value="false"/>
	<property name="compile.deprecation" value="false"/>
	<property name="compile.optimize" value="false"/>
	
	
	
	
	 <path id="cpath">
	    <pathelement location="../ROOT/WebContent/WEB-INF/lib/testng-6.8.jar"/>
	 </path>
	
	<path id="runpath">
	 	<path refid="cpath"/>
	 	<pathelement location="../ROOT/build/classes"/>
		<fileset dir="../ROOT/WebContent/WEB-INF/lib" includes="*.jar"/>
        <fileset id="appserver-lib-jars" dir="${local.catalina.home}/lib" includes="*.jar" />
        <fileset id="appserver-bin-jars" dir="${local.catalina.home}/bin" includes="*.jar" />
	 </path>
	
	<taskdef name="testng" classpathref="cpath" classname="org.testng.TestNGAntTask" />
	 
	 <!-- <target name="test">
	   <testng classpathref="runpath" outputdir="${testng.report.dir}" dumpenv="true" dumpsys="true" verbose="2">
	   	<xmlfileset dir="../ROOT/test" includes="testng.xml"/>
	   </testng>
	 </target> -->
	
	<target name="test">
		
		        <!-- Create build folder if it doesn't exist -->
		        <delete dir="${workdir}/build" failonerror="false"/>
		        <mkdir dir="${workdir}/build"/>
		        <mkdir dir="${workdir}/build/classes"/>
		        <mkdir dir="${workdir}/build/classes/test"/>
		         
		        <javac fork="true" 
		           sourcepath="" 
		           srcdir="${workdir}" 
		           destdir="${workdir}/build/classes" 
		           debug="${compile.debug}" 
		           deprecation="${compile.deprecation}" 
		           optimize="${compile.optimize}" 
		           memoryinitialsize="256m" 
		           memorymaximumsize="512m" 
		           classpathref="runpath"
		           includeantruntime="false">
		            <exclude name="org/ei/data/books/tools/**" />
		            <exclude name="org/ei/data/books/tocs/*" />
		        </javac>
		  
		        <javac fork="true" 
		           sourcepath="" 
		           srcdir="${test.build.dir}" 
		           destdir="${workdir}/build/classes/test" 
		           debug="${compile.debug}" 
		           deprecation="${compile.deprecation}" 
		           optimize="${compile.optimize}" 
		           memoryinitialsize="256m" 
		           memorymaximumsize="512m" 
		           classpathref="runpath"
		           includeantruntime="false">
		        </javac>
		        
		        <copy todir="${workdir}/build/classes">
		            <fileset dir="${workdir}/src" excludes="**/*.java" />
		            <fileset dir="${workdir}/resources" excludes="**/*.java" />
		            <fileset dir="${workdir}/resources"/>
		        </copy>
		        

		
            	<testng classpathref="runpath" outputDir="${testng.report.dir}" haltOnFailure="true" verbose="2">
            		 <classfileset dir="${workdir}/build/classes/test" includes="**/*.class" />
            	</testng>
	</target>
	
	
</project>