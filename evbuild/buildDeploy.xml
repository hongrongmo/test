 <project name="Deploy" default="deploy-all">
	<property environment="env"/>

	<!-- Default the property include to "local" -->
	<property name="property_include" value="local"/>
	<property file="properties/${property_include}.properties"/>
	
	<path id="catalina-ant-classpath">
	    <!-- We need the Catalina jars for Tomcat -->
	    <!--  * for other app servers - check the docs --> 
	    <fileset  dir="${local.catalina.home}/lib">
	        <include name="catalina-ant.jar"/>
	        <include name="tomcat-coyote.jar"/>
	        <include name="tomcat-util.jar"/>
	    </fileset>
	    <fileset dir="${local.catalina.home}/bin">
	                <include name="tomcat-juli.jar"/>
	    </fileset>
	</path>
	
	<!-- Configure the custom Ant tasks for the Manager application -->
  <taskdef name="list"      classname="org.apache.catalina.ant.ListTask" classpathref="catalina-ant-classpath"/>
  <taskdef name="reload"    classname="org.apache.catalina.ant.ReloadTask" classpathref="catalina-ant-classpath"/>
  <taskdef name="resources" classname="org.apache.catalina.ant.ResourcesTask" classpathref="catalina-ant-classpath"/>
  <taskdef name="start"     classname="org.apache.catalina.ant.StartTask" classpathref="catalina-ant-classpath"/>
  <taskdef name="stop"      classname="org.apache.catalina.ant.StopTask" classpathref="catalina-ant-classpath"/>
  <taskdef name="undeploy"  classname="org.apache.catalina.ant.UndeployTask" classpathref="catalina-ant-classpath"/>
  <taskdef name="deploy"  classname="org.apache.catalina.ant.DeployTask" classpathref="catalina-ant-classpath"/>

	<target name="showProperties">
		<echo>
PROPERTIES FOR buildDeploy
=====================================
staging directory = ${local.webapp.staging}
CATALINA_HOME=${local.catalina.home}
ANT_HOME=${env.ANT_HOME}
		</echo>
	</target>
	
	<!-- *************************************************************** -->
	<!-- Clean ALL WAR files from staging directory -->
	<!-- *************************************************************** -->
	<target name="clean">
		<echo message="Remove old .war files..."/>
		<mkdir dir="${local.webapp.staging}"/>
		<mkdir dir="${local.webapp.staging}/webapps"/>
		<echo message="Complete!"/>
	</target>

	<!-- *************************************************************** -->
	<!-- Create and deploy an application WAR file -->
	<!-- *************************************************************** -->
	<target name="create-war">
		<echo message="Make ${webapp}.war..."/>
		<war 
			destfile="${local.webapp.staging}/webapps/${webapp}.war" 
			webxml="../${webapp}/WebContent/WEB-INF/web.xml">
			<fileset dir="../${webapp}/WebContent"></fileset>
			<lib dir="../${webapp}/WebContent/WEB-INF/lib"></lib>
			<classes dir="../${webapp}/build/classes" erroronmissingdir="false"></classes>
		</war>
	</target>

	<!-- *************************************************************** -->
	<!-- Create ALL WAR files! -->
	<!-- *************************************************************** -->
	<target name="create-wars" depends="clean">
		<ant antfile="../logservice/build.xml" target="war"><param name="basedir" value="../logservice"/></ant>
		<ant antfile="../engvillage/build.xml" target="war"><param name="basedir" value="../logservice"/></ant>
		<ant antfile="../citedby/build.xml" target="war"><param name="basedir" value="../logservice"/></ant>
		<ant antfile="../docview/build.xml" target="war"><param name="basedir" value="../logservice"/></ant>
		<ant antfile="../ROOT/build.xml" target="war"><param name="basedir" value="../logservice"/></ant>
	</target>

	<!-- *************************************************************** -->
	<!-- Deploy ALL WAR files! -->
	<!-- *************************************************************** -->
	<target name="deploy-all" depends="showProperties, clean">
		<echo message="******* Deploying all WAR files... ********"/> 
		<subant antfile="../logservice/build.xml" buildpath="../logservice" target="deploy"></subant>
		<subant antfile="../engvillage/build.xml" buildpath="../engvillage" target="deploy"></subant>
		<subant antfile="../citedby/build.xml" buildpath="../citedby" target="deploy"></subant>
		<subant antfile="../docview/build.xml" buildpath="../docivew" target="deploy"></subant>
		<subant antfile="../ROOT/build.xml" buildpath="../ROOT" target="deploy"></subant>
		
		<echo message="******* Done! ********"/> 
	</target>
	
	<!-- *************************************************************** -->
	<!-- Undeploy ALL WAR files!                                         -->
	<!-- *************************************************************** -->
	<target name="undeploy-all">
		
		<undeploy url="${data_server.tomcat.manager.url}" 
			username="${data_server.tomcat.username}" 
			password="${data_server.tomcat.password}"
			path="/engvillage" failonerror="false"/>
		
		<undeploy url="${controller_server.tomcat.manager.url}" 
			username="${controller_server.tomcat.username}" 
			password="${controller_server.tomcat.password}"
			path="/citedby" failonerror="false"/>
	
		<undeploy url="${log_server.tomcat.manager.url}" 
			username="${log_server.tomcat.username}" 
			password="${log_server.tomcat.password}"
			path="/logservice" failonerror="false"/>

		<undeploy url="${controller_server.tomcat.manager.url}" 
			username="${controller_server.tomcat.username}" 
			password="${controller_server.tomcat.password}"
			path="/" failonerror="false"/>

        <undeploy url="${controller_server.tomcat.manager.url}" 
                    username="${controller_server.tomcat.username}" 
                    password="${controller_server.tomcat.password}"
                    path="/docview" failonerror="false"/>
        
		<!--
        <undeploy url="${session_server.tomcat.manager.url}" 
            username="${session_server.tomcat.username}" 
            password="${session_server.tomcat.password}"
            path="/sessionservice" failonerror="false"/>

		<undeploy url="${controller_server.tomcat.manager.url}" 
			username="${controller_server.tomcat.username}" 
			password="${controller_server.tomcat.password}"
			path="/engresources" failonerror="false"/>
		-->

		<sleep seconds="7"/>  <!-- Give undeploys time to finish! -->
	</target>


</project>
